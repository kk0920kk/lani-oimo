<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Lani VS ã„ã‚ã‚“ãªãŠèŠ‹é”</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(180deg, #fff7e6, #ffe0b2);
      min-height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .app {
      position: relative;
      width: 380px;
      max-width: 95vw;
      background: #ffffff;
      border-radius: 18px;
      padding: 16px 18px 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      overflow: hidden;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 4px;
      text-align: center;
    }
    .subtitle {
      font-size: 12px;
      color: #8c6b3f;
      text-align: center;
      margin-bottom: 4px;
    }
    .top-status {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #6a5432;
      margin-bottom: 8px;
    }
    .battle-area {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .enemy-area,
    .player-area {
      margin-top: 4px;
      padding: 10px;
      border-radius: 14px;
      background: #fff8e6;
      border: 1px solid #f3c57a;
      position: relative;
      overflow: hidden;
    }
    .player-area {
      background: #e9f7ff;
      border-color: #80c4ff;
    }
    .enemy-name,
    .player-name {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .enemy-emoji,
    .player-emoji {
      font-size: 60px;
      text-align: center;
      margin: 4px 0;
      transition: transform 0.12s, filter 0.12s;
    }
    .enemy-emoji.hit,
    .player-emoji.hit {
      transform: translateY(-3px) scale(1.05);
    }
    .enemy-emoji.crit,
    .player-emoji.crit {
      filter: drop-shadow(0 0 10px rgba(255, 50, 50, 0.9));
      animation: critShake 0.3s ease-in-out;
    }
    @keyframes critShake {
      0% { transform: translate(-1px, -2px) scale(1.1); }
      25% { transform: translate(2px, -1px) scale(1.1); }
      50% { transform: translate(-2px, 1px) scale(1.1); }
      75% { transform: translate(1px, 2px) scale(1.1); }
      100% { transform: translate(0,0) scale(1.05); }
    }
    .hp-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 4px;
      color: #6a5432;
    }
    .player-area .hp-label-row {
      color: #356079;
    }
    .hp-bar-container {
      width: 100%;
      height: 14px;
      background: #f0e0c2;
      border-radius: 999px;
      overflow: hidden;
    }
    .player-area .hp-bar-container {
      background: #cde9ff;
    }
    .hp-bar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #ff5252, #ffb347);
      transition: width 0.15s;
    }
    .player-area .hp-bar {
      background: linear-gradient(90deg, #42a5f5, #81c784);
    }
    .log {
      margin-top: 10px;
      min-height: 3.2em;
      font-size: 13px;
      color: #5c4630;
      white-space: pre-line;
    }
    .controls {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .attack-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 6px;
    }
    button {
      padding: 8px 0;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
      transition: transform 0.08s, box-shadow 0.08s, opacity 0.12s;
      white-space: nowrap;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.18);
    }
    .attack-btn {
      background: linear-gradient(135deg, #ff7043, #ffb300);
      color: #fff;
    }
    #retryButton {
      background: #ece0d1;
      color: #5c4630;
      width: 100%;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }
    .hint {
      margin-top: 6px;
      font-size: 11px;
      color: #9b7a4a;
      text-align: center;
    }
    .damage-pop {
      position: absolute;
      left: 50%;
      top: 20%;
      transform: translateX(-50%);
      font-weight: 700;
      font-size: 18px;
      color: #ff5722;
      text-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
      pointer-events: none;
      animation: popUp 0.6s ease-out forwards;
    }
    .damage-pop.crit {
      color: #ff1744;
      font-size: 22px;
      text-shadow: 0 0 8px rgba(255, 23, 68, 0.9);
    }
    @keyframes popUp {
      0% {
        opacity: 0;
        transform: translate(-50%, 0) scale(0.8);
      }
      20% {
        opacity: 1;
        transform: translate(-50%, -8px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -32px) scale(1);
      }
    }

    /* 1080 / 5555 ç”¨ä¸­å¤®ãƒ“ãƒƒã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .big-effect {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
    }
    .big-effect-text {
      padding: 12px 20px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid #ff7043;
      font-size: 20px;
      font-weight: 800;
      color: #ff5722;
      box-shadow: 0 0 20px rgba(255, 112, 67, 0.7);
      transform: scale(0.5);
    }
    .big-effect.show {
      animation: bigPop 0.9s ease-out forwards;
    }
    @keyframes bigPop {
      0% {
        opacity: 0;
        transform: scale(0.7);
      }
      20% {
        opacity: 1;
        transform: scale(1.05);
      }
      60% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0.9);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Lani VS ã„ã‚ã‚“ãªãŠèŠ‹é” ğŸ </h1>
    <div class="subtitle">ãŸãã•ã‚“å€’ã—ã¦ãƒ©ã‚¤ãƒãƒ¼ã¨ã—ã¦æˆé•·ã™ã‚‹ãï¼</div>

    <!-- ç·è¨ä¼æ•°è¡¨ç¤º -->
    <div class="top-status">
      <span id="totalKillsText">ç·è¨ä¼æ•°ï¼š0ä½“</span>
      <span id="currentEnemyLabel">ç¾åœ¨ã®æ•µï¼š-</span>
    </div>

    <div class="battle-area">
      <!-- æ•µã‚¨ãƒªã‚¢ -->
      <div class="enemy-area" id="enemyArea">
        <div class="enemy-name" id="enemyName"></div>
        <div class="enemy-emoji" id="enemyEmoji">ğŸ </div>
        <div class="hp-label-row">
          <span>æ•µHP</span>
          <span id="hpText">0 / 0</span>
        </div>
        <div class="hp-bar-container">
          <div class="hp-bar" id="hpBar"></div>
        </div>
      </div>

      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ -->
      <div class="player-area" id="playerArea">
        <div class="player-name" id="playerName">ãŠèŠ‹ãƒãƒ³ã‚¿ãƒ¼Lani</div>
        <div class="player-emoji" id="playerEmoji">ğŸ‘§</div>
        <div class="hp-label-row">
          <span>è‡ªåˆ†ã®HP</span>
          <span id="playerHpText">9999 / 9999</span>
        </div>
        <div class="hp-bar-container">
          <div class="hp-bar" id="playerHpBar"></div>
        </div>
      </div>
    </div>

    <!-- ãƒãƒˆãƒ«ãƒ­ã‚° -->
    <div class="log" id="logText">æ”»æ’ƒãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒãƒˆãƒ«é–‹å§‹ï¼</div>

    <!-- ãƒœã‚¿ãƒ³ -->
    <div class="controls">
      <div class="attack-row">
        <button id="btn55" class="attack-btn">ï¼•ï¼•</button>
        <button id="btn111" class="attack-btn">ï¼‘ï¼‘ï¼‘</button>
        <button id="btn1080" class="attack-btn">ï¼‘ï¼ï¼˜ï¼</button>
        <button id="btn5555" class="attack-btn">ï¼•ï¼•ï¼•ï¼•</button>
      </div>
      <button id="retryButton">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="hint">
      ãƒ»æ•µã‚’å€’ã™ãŸã³ã«HPå…¨å›å¾©ï¼†æ¬¡ã®ãŠèŠ‹ãŒãƒ©ãƒ³ãƒ€ãƒ å‡ºç¾<br />
      ãƒ»ç·è¨ä¼æ•°ã¯ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚å¼•ãç¶™ãŒã‚Œã¾ã™
    </div>

    <!-- ä¸­å¤®ãƒ“ãƒƒã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ -->
    <div id="bigEffect" class="big-effect">
      <div id="bigEffectText" class="big-effect-text">è¨ä¼æ•° +0</div>
    </div>
  </div>

  <script>
    // ============================
    // æ•µãƒ‡ãƒ¼ã‚¿ï¼ˆHPã¯ã™ã¹ã¦10ï¼‰
    // ============================
    const enemies = [
      { name: "ä¸€ç”Ÿã‚°ãƒ¬ãƒ¼ã®ãŠèŠ‹", maxHp: 10, emoji: "ğŸ " },
      { name: "èŠ±ç«ã‚¿ã‚°ã‹ã‚‰ãã¦BOXã¨ã‚ã†ã¨ã™ã‚‹ãŠèŠ‹", maxHp: 10, emoji: "ğŸ†ğŸ " },
      { name: "ã‚·ãƒ³ãƒ—ãƒ«ãªå¤‰æ…‹ãŠèŠ‹", maxHp: 10, emoji: "ğŸ˜ˆğŸ " },
      { name: "æ ã«å…¥ã£ã¦ãã¦ã™ãè¦‹ãŸç›®ã‚’ãƒ‡ã‚£ã‚¹ã‚‹ãŠèŠ‹", maxHp: 10, emoji: "ğŸ˜’ğŸ " },
      { name: "ã™ã£ã”ã„ãƒ¡ãƒ³ãƒ˜ãƒ©ãŠèŠ‹", maxHp: 10, emoji: "ğŸ¥ºğŸ " },
      { name: "ä½•ã‹è‰²ã€…è‡ªæ…¢ã°ã£ã‹ã‚ŠãŠèŠ‹", maxHp: 10, emoji: "ğŸ˜ğŸ " },
      { name: "ã‚³ã‚¢ã‚‚ã¨ã£ã¦ãªã„ã®ã«DMã—ã¦ãã‚‹ãŠèŠ‹", maxHp: 10, emoji: "ğŸ“©ğŸ " },
      { name: "ä½•ã‹æƒœã—ã„èŠ‹", maxHp: 10, emoji: "ğŸ¤ğŸ " },
      { name: "ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæ·±å €ã‚ŠãŠèŠ‹", maxHp: 10, emoji: "ğŸ•µï¸â€â™‚ï¸ğŸ " },
      { name: "è¦‹è¿”ã‚Šå¼·è¦ãŠèŠ‹", maxHp: 10, emoji: "ğŸ¤ğŸ " },
      { name: "ã‚¢ãƒ‰ãƒã‚¤ã‚¹æŠ¼ã—ä»˜ã‘ãŠèŠ‹", maxHp: 10, emoji: "ğŸ“¢ğŸ " },
      { name: "ä»–ã®ãƒªã‚¹ãƒŠãƒ¼æ”»æ’ƒãŠèŠ‹", maxHp: 10, emoji: "ğŸ’£ğŸ " },
      { name: "ãªãœã‹ä¸Šã‹ã‚‰ç›®ç·šãŠèŠ‹", maxHp: 10, emoji: "ğŸ‘‘ğŸ " },
      { name: "ãƒã‚¬ãƒ†ã‚£ãƒ–ç™ºè¨€ç¥­ã‚ŠãŠèŠ‹", maxHp: 10, emoji: "ğŸŒ€ğŸ " },
      { name: "æ å³æŠœãŠèŠ‹", maxHp: 10, emoji: "ğŸƒâ€â™‚ï¸ğŸ " },
      { name: "æŠ•ã’ã‚‹æŠ•ã’ã‚‹è©æ¬ºãŠèŠ‹", maxHp: 10, emoji: "ğŸ’¸ğŸ " },
      { name: "ææ€–ã®ç„¡è¨€å±…åº§ã‚ŠãŠèŠ‹", maxHp: 10, emoji: "ğŸ‘€ğŸ " },
      { name: "è³å‘³æœŸé™ã®ãã‚ŒãŸãŠèŠ‹", maxHp: 10, emoji: "ğŸ’€ğŸ " },
      { name: "åå‰ãŒå‘çŒ¥ã™ãã‚‹ãŠèŠ‹", maxHp: 10, emoji: "ğŸ™ˆğŸ " },
      { name: "æ‰¿èªæ¬²æ±‚ã®å¡ŠãŠèŠ‹", maxHp: 10, emoji: "ğŸ“¸ğŸ " },
      { name: "ã‚ã€ã©ã†ã‚‚ã€èŠ‹ã§ã™", maxHp: 10, emoji: "ğŸ™‹â€â™‚ï¸ğŸ " },
      { name: "è·é›¢æ„Ÿãƒã‚°ã£ã¦ã‚‹ãŠèŠ‹", maxHp: 10, emoji: "ğŸ¤ğŸ " }
    ];

    const PLAYER_MAX_HP = 9999;

    let currentEnemyIndex = 0;
    let enemyHp = enemies[currentEnemyIndex].maxHp;
    let playerHp = PLAYER_MAX_HP;
    let totalKills = 0;
    let isBusy = false;

    // ============================
    // DOMå–å¾—
    // ============================
    const enemyNameEl = document.getElementById("enemyName");
    const enemyEmojiEl = document.getElementById("enemyEmoji");
    const hpTextEl = document.getElementById("hpText");
    const hpBarEl = document.getElementById("hpBar");

    const playerEmojiEl = document.getElementById("playerEmoji");
    const playerHpTextEl = document.getElementById("playerHpText");
    const playerHpBarEl = document.getElementById("playerHpBar");

    const enemyAreaEl = document.getElementById("enemyArea");
    const playerAreaEl = document.getElementById("playerArea");

    const logTextEl = document.getElementById("logText");
    const totalKillsTextEl = document.getElementById("totalKillsText");
    const currentEnemyLabelEl = document.getElementById("currentEnemyLabel");

    const btn55 = document.getElementById("btn55");
    const btn111 = document.getElementById("btn111");
    const btn1080 = document.getElementById("btn1080");
    const btn5555 = document.getElementById("btn5555");
    const retryButton = document.getElementById("retryButton");

    const bigEffectEl = document.getElementById("bigEffect");
    const bigEffectTextEl = document.getElementById("bigEffectText");

    // ============================
    // ã‚µã‚¦ãƒ³ãƒ‰ï¼ˆæ‰“æ’ƒéŸ³ & æ–¬æ’ƒéŸ³ï¼‰
    // ============================
    let audioCtx = null;
    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    // æ‰“æ’ƒéŸ³ï¼šçŸ­ã„ä½ã‚ã®ã€Œãƒ‰ãƒ³ã€
    function playHitSound() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "square";
      osc.frequency.setValueAtTime(220, now);
      osc.frequency.exponentialRampToValueAtTime(110, now + 0.08);

      gain.gain.setValueAtTime(0.35, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.12);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(now);
      osc.stop(now + 0.15);
    }

    // æ–¬æ’ƒéŸ³ï¼šé«˜ã‚ã®ã‚·ãƒ£ã‚­ãƒ¼ãƒ³ï¼ˆæ•µæ’ƒç ´ç”¨ï¼‰
    function playKillSound() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;

      const osc1 = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc1.type = "sawtooth";
      osc2.type = "square";

      osc1.frequency.setValueAtTime(900, now);
      osc1.frequency.exponentialRampToValueAtTime(300, now + 0.18);

      osc2.frequency.setValueAtTime(1500, now);
      osc2.frequency.exponentialRampToValueAtTime(500, now + 0.18);

      gain.gain.setValueAtTime(0.3, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.22);

      osc1.connect(gain);
      osc2.connect(gain);
      gain.connect(audioCtx.destination);

      osc1.start(now);
      osc2.start(now);
      osc1.stop(now + 0.22);
      osc2.stop(now + 0.22);
    }

    // ============================
    // ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«
    // ============================
    const baseDamageTable = [
      { value: 3, weight: 2.5 },
      { value: 4, weight: 2.5 },
      { value: 5, weight: 10 },
      { value: 6, weight: 10 },
      { value: 7, weight: 10 },
      { value: 8, weight: 10 },
      { value: 9, weight: 10 },
      { value: 10, weight: 25 },
      { value: 15, weight: 15 },
      { value: 9999, weight: 5 }
    ];
    const totalBaseWeight = baseDamageTable.reduce((s, d) => s + d.weight, 0);

    const damageTable55 = [
      { value: 1, weight: 50 },
      { value: 2, weight: 25 },
      { value: 3, weight: 20 },
      { value: 9999, weight: 5 }
    ];
    const total55 = damageTable55.reduce((s, d) => s + d.weight, 0);

    const damageTable111 = [
      { value: 2, weight: 50 },
      { value: 4, weight: 25 },
      { value: 6, weight: 20 },
      { value: 9999, weight: 5 }
    ];
    const total111 = damageTable111.reduce((s, d) => s + d.weight, 0);

    function drawFromTable(table, totalWeight) {
      const r = Math.random() * totalWeight;
      let acc = 0;
      for (const d of table) {
        acc += d.weight;
        if (r <= acc) return d.value;
      }
      return table[table.length - 1].value;
    }

    const damageTables = {
      "55":  { table: damageTable55,  total: total55 },
      "111": { table: damageTable111, total: total111 }
    };

    function getDamageForSkill(skillKey) {
      const info = damageTables[skillKey];
      if (!info) return drawFromTable(baseDamageTable, totalBaseWeight);
      return drawFromTable(info.table, info.total);
    }

    function getEnemyDamage() {
      return drawFromTable(baseDamageTable, totalBaseWeight);
    }

    // ============================
    // æ¼”å‡º
    // ============================
    function showDamagePop(targetEl, value, isCrit = false, isFromEnemy = false) {
      const pop = document.createElement("div");
      pop.classList.add("damage-pop");
      if (isCrit) pop.classList.add("crit");
      pop.style.top = isFromEnemy ? "30%" : "20%";
      pop.textContent = value;
      targetEl.appendChild(pop);
      setTimeout(() => pop.remove(), 650);
    }

    function showBigEffect(addValue) {
      bigEffectTextEl.textContent = `è¨ä¼æ•° +${addValue}`;
      bigEffectEl.classList.remove("show");
      void bigEffectEl.offsetWidth;
      bigEffectEl.classList.add("show");
      setTimeout(() => {
        bigEffectEl.classList.remove("show");
      }, 900);
    }

    // ============================
    // çŠ¶æ…‹æ›´æ–°ãƒ»æç”»
    // ============================
    function render() {
      const enemy = enemies[currentEnemyIndex];
      enemyNameEl.textContent = `${enemy.name}ï¼ˆHP ${enemy.maxHp}ï¼‰`;
      enemyEmojiEl.textContent = enemy.emoji;

      if (enemyHp < 0) enemyHp = 0;
      if (playerHp < 0) playerHp = 0;

      hpTextEl.textContent = `${enemyHp} / ${enemy.maxHp}`;
      const eratio = Math.max(0, enemyHp / enemy.maxHp);
      hpBarEl.style.width = (eratio * 100) + "%";

      playerHpTextEl.textContent = `${playerHp} / ${PLAYER_MAX_HP}`;
      const pratio = Math.max(0, playerHp / PLAYER_MAX_HP);
      playerHpBarEl.style.width = (pratio * 100) + "%";

      totalKillsTextEl.textContent = `ç·è¨ä¼æ•°ï¼š${totalKills}ä½“`;
      currentEnemyLabelEl.textContent = `ç¾åœ¨ã®æ•µï¼š${enemy.name}`;
    }

    function spawnNewEnemy() {
      const idx = Math.floor(Math.random() * enemies.length);
      currentEnemyIndex = idx;
      const enemy = enemies[currentEnemyIndex];
      enemyHp = enemy.maxHp;
      render();
      logTextEl.textContent += `\næ–°ãŸãªæ•µã€Œ${enemy.name}ã€ãŒã‚ã‚‰ã‚ã‚ŒãŸï¼`;
    }

    function enableAttackButtons(flag) {
      btn55.disabled = !flag;
      btn111.disabled = !flag;
      btn1080.disabled = !flag;
      btn5555.disabled = !flag;
    }

    // ç·è¨ä¼æ•°ã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„
    function resetBattle() {
      playerHp = PLAYER_MAX_HP;
      const idx = Math.floor(Math.random() * enemies.length);
      currentEnemyIndex = idx;
      enemyHp = enemies[currentEnemyIndex].maxHp;
      isBusy = false;
      enableAttackButtons(true);
      logTextEl.textContent = "æ”»æ’ƒãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒãƒˆãƒ«é–‹å§‹ï¼";
      render();
    }

    function checkPlayerDeath() {
      if (playerHp <= 0) {
        logTextEl.textContent += `\nãŠèŠ‹ãƒãƒ³ã‚¿ãƒ¼Laniã¯å€’ã‚Œã¦ã—ã¾ã£ãŸâ€¦ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ10å›ã§é›ãˆãªãŠã—ã¦å†æŒ‘æˆ¦ï¼ğŸ’¤`;
        enableAttackButtons(false);
        return true;
      }
      return false;
    }

    // ============================
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ”»æ’ƒã€œæ•µåæ’ƒ
    // ============================
    function doPlayerAttack(skillKey) {
      initAudio();
      if (playerHp <= 0 || isBusy) return;

      // 1080 / 5555ï¼šç›®ã®å‰ã®æ•µã‚’å³è¨ä¼ï¼‹è¿½åŠ è¨ä¼ãƒœãƒ¼ãƒŠã‚¹
      if (skillKey === "1080" || skillKey === "5555") {
        if (enemyHp <= 0) return; // æ—¢ã«æ•µãŒã„ãªã„å ´åˆã¯ç„¡åŠ¹
        isBusy = true;

        const addKills = skillKey === "1080" ? 2 : 11; // åˆè¨ˆã§2ä½“ / 11ä½“ã¶ã‚“
        const enemyName = enemies[currentEnemyIndex].name;

        // ç›®ã®å‰ã®æ•µã‚’å³è¨ä¼
        enemyHp = 0;
        totalKills += addKills;
        playerHp = PLAYER_MAX_HP; // Laniå…¨å›å¾©

        if (skillKey === "1080") {
          logTextEl.textContent =
            `ã‚‰ã«ã¡ã‚ƒã‚“ã¨ãƒãƒ³ãƒãƒ³ã—ã‚ˆã‰\n${enemyName} ã‚’ä¸€ç¬ã§è¨ä¼ï¼\nè¨ä¼æ•°ãŒ${addKills}ä½“ã¶ã‚“å¢—ãˆãŸï¼`;
        } else {
          logTextEl.textContent =
            `ã‚‰ã«ã¡ã‚ƒã‚“ã¨ã„ã„ã“ã¨ã—ã‚ˆãƒ¼ã­â™¡\n${enemyName} ã‚’ä¸€ç¬ã§è¨ä¼ï¼\nè¨ä¼æ•°ãŒ${addKills}ä½“ã¶ã‚“å¢—ãˆãŸï¼`;
        }

        playKillSound();       // æ–¬æ’ƒéŸ³
        render();
        showBigEffect(addKills);

        setTimeout(() => {
          spawnNewEnemy();
          isBusy = false;
        }, 900);

        return;
      }

      // ã“ã“ã‹ã‚‰ 55 / 111 ã®é€šå¸¸æ”»æ’ƒ
      if (enemyHp <= 0) return;
      isBusy = true;

      const dmg = getDamageForSkill(skillKey);
      const isCrit = dmg === 9999;

      playHitSound(); // æ‰“æ’ƒéŸ³ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ”»æ’ƒï¼‰

      enemyHp -= dmg;
      enemyEmojiEl.classList.add("hit");
      if (isCrit) enemyEmojiEl.classList.add("crit");
      showDamagePop(enemyAreaEl, `-${dmg}`, isCrit, false);

      if (isCrit) {
        logTextEl.textContent = `ä¼šå¿ƒã®ä¸€æ’ƒï¼ï¼ ${dmg} ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚ãŸãˆãŸï¼`;
      } else {
        logTextEl.textContent =
          `ã“ã†ã’ãï¼ï¼ˆ${skillKey}ï¼‰ ${dmg} ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚ãŸãˆãŸï¼`;
      }

      render();

      setTimeout(() => {
        enemyEmojiEl.classList.remove("hit");
        enemyEmojiEl.classList.remove("crit");
      }, 300);

      // æ•µæ’ƒç ´
      if (enemyHp <= 0) {
        enemyHp = 0;
        totalKills += 1;
        logTextEl.textContent += `\n${enemies[currentEnemyIndex].name} ã‚’å€’ã—ãŸï¼ğŸ âœ¨`;
        playerHp = PLAYER_MAX_HP;
        logTextEl.textContent += `\nãŠèŠ‹ãƒãƒ³ã‚¿ãƒ¼Laniã®HPã¯å…¨å›å¾©ã—ãŸï¼ğŸ’–`;
        playKillSound();  // æ–¬æ’ƒéŸ³
        render();

        setTimeout(() => {
          spawnNewEnemy();
          isBusy = false;
        }, 500);
        return;
      }

      // æ•µã®åæ’ƒ
      setTimeout(() => {
        if (playerHp <= 0 || enemyHp <= 0) {
          isBusy = false;
          return;
        }

        const enemyDmg = getEnemyDamage();
        const enemyCrit = enemyDmg === 9999;

        playHitSound(); // æ‰“æ’ƒéŸ³ï¼ˆæ•µã®æ”»æ’ƒï¼‰

        playerHp -= enemyDmg;
        playerEmojiEl.classList.add("hit");
        if (enemyCrit) playerEmojiEl.classList.add("crit");
        showDamagePop(playerAreaEl, `-${enemyDmg}`, enemyCrit, true);

        if (enemyCrit) {
          logTextEl.textContent +=
            `\n${enemies[currentEnemyIndex].name} ã®ä¼šå¿ƒã®ä¸€æ’ƒï¼ï¼ Laniã¯ ${enemyDmg} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`;
        } else {
          logTextEl.textContent +=
            `\n${enemies[currentEnemyIndex].name} ã®åæ’ƒï¼ Laniã¯ ${enemyDmg} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`;
        }

        render();

        setTimeout(() => {
          playerEmojiEl.classList.remove("hit");
          playerEmojiEl.classList.remove("crit");
        }, 250);

        checkPlayerDeath();
        isBusy = false;
      }, 500);
    }

    // ============================
    // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
    // ============================
    btn55.addEventListener("click", () => doPlayerAttack("55"));
    btn111.addEventListener("click", () => doPlayerAttack("111"));
    btn1080.addEventListener("click", () => doPlayerAttack("1080"));
    btn5555.addEventListener("click", () => doPlayerAttack("5555"));
    retryButton.addEventListener("click", resetBattle);

    // åˆæœŸçŠ¶æ…‹
    resetBattle();
  </script>
</body>
</html>
